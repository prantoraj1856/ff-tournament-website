Html
<input type="file" id="proof">
Copy code
Js
import { getStorage, ref, uploadBytes, getDownloadURL }
from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";

const storage = getStorage();

window.join = async () => {
  const file = proof.files[0];
  const imgRef = ref(storage, `payments/${auth.currentUser.uid}_${Date.now()}`);
  await uploadBytes(imgRef, file);
  const url = await getDownloadURL(imgRef);

  await addDoc(collection(db,"registrations"),{
    uid: auth.currentUser.uid,
    tid: tid.value,
    pay: pay.value,
    trx: trx.value,
    proof: url,
    status: "pending"
  });
  alert("Submitted with screenshot");
};Js
import { query, where } from
"https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const q = query(
  collection(db,"registrations"),
  where("uid","==",auth.currentUser.uid),
  where("tid","==",tid.value)
);
const snap = await getDocs(q);
if(!snap.empty){
  alert("Already registered!");
  return;
}Js
rules_version = '2';
service cloud.firestore {
 match /databases/{db}/documents {

  match /users/{uid} {
    allow read, write: if request.auth.uid == uid;
  }

  match /tournaments/{id} {
    allow read: if true;
    allow write: if request.auth.token.email == "admin@gmail.com";
  }

  match /registrations/{id} {
    allow create: if request.auth != null;
    allow read, update, delete:
      if request.auth.token.email == "admin@gmail.com";
  }
 }
}
